<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment 3 | Magical Animal Generator</title>

    <script>
        window.addEventListener("DOMContentLoaded",() => {
            // fetching tags and storing them in variables
            const outerdiv = document.getElementById("outerdiv");
            const form = document.getElementById("form");
            const type = document.getElementById("type");
            const name = document.getElementById("name");
            const month = document.getElementById("month");
            const color = document.getElementById("color");
            const material = document.getElementById("material");
          

            // this creates an error element below a given 
            const createErrorElement = (element, errorMessage)=>{
                // create a tag for value errors
                const valueError = document.createElement("h4");
                valueError.className = "warn";
                valueError.innerText = errorMessage;
                element.insertAdjacentElement("afterend", valueError);
            }
            
            // this removes an errror element
            const removeErrorElement = element=>{
                const errorElement = element.nextElementSibling;
                if (errorElement && errorElement.classList.contains("warn")) {
                    errorElement.remove();
                }
            }

            // this adds an error tag to an element
            const errorCheck = (element, regex, errorMessage)=>{
                // remove previous errors before checking
                removeErrorElement(element);

                // if doesn't match, add the warning tag and return true
                if (!(regex.test(element.value))) {                  
                    createErrorElement(element, errorMessage);
                    return true
                }
                // if matches, remove it and return false
                else {
                    removeErrorElement(element);
                    return false
                }
            }


            // if values are in storage, this will fill them out
            type.value = localStorage.getItem("type");
            name.value = localStorage.getItem("name");
            color.value = localStorage.getItem("color");
            month.value = localStorage.getItem("month");
            material.value = localStorage.getItem("material");
            

            // event for when the "Submit button is pressed"
            form.addEventListener("submit",e => {
                // prevent tab reloading
                e.preventDefault();
                
                // error checking
                var error = false;

                // type can be letters
                if ( errorCheck(type, /^[a-zA-Z]+$/, "Invalid type") )
                    error = true;

                // name can be letters, single quotes, and dashes
                if ( errorCheck(name, /^[a-zA-Z-']+$/, "Invalid name") )
                    error = true;

                // material can be letters, single quotes, and dashes
                if ( errorCheck(material, /^[a-zA-Z-']+$/, "Invalid material") )
                    error = true;

                // abort if errors have been found
                if (error) return;
                

                // check if local storage is available
                if (localStorage) {
                    // update values in storage
                    localStorage.setItem("type", type.value);
                    localStorage.setItem("name", name.value);
                    localStorage.setItem("color", color.value);
                    localStorage.setItem("month", month.value);
                    localStorage.setItem("material",material.value);
                } else {
                    // if no local storage, display a warning message
                    createErrorElement(document.body,
                        "Local storage is not available. Your progress will be lost on exit");
                }

                // make a paragraph to be copied and pasted
                const message = document.createElement("p");

                // compose the content
                
                message.textContent = "Generate me a " + type.value + " named " + name.value + " born in " + month.value + " that is hex colour " + color.value + " and is made of " + material.value;

                // add to outerdiv
                outerdiv.appendChild(message);
            })


        })
    </script>
    <style>
        body{
            text-align: center;
            background-image: url("bg.jpeg");
            background-size: cover;
        }
        form{
            display: inline-block;
            text-align: left;
            
        }
        #outerdiv{
            display: inline-block;
            background-color: grey;
            text-align: center;
            opacity: 0.85;
        }
        .warn { /* style for error warnings */
            display: block;
            background-color: yellow;
            padding-left: 30px;
            padding-right: 30px;
            margin: 0;
            width: 50%;
            font-size: 22px;
            border-radius: 15px;
            text-align: center;

        }
    </style>
</head>
<body>
    <div id="outerdiv">
        <form action="" id ="form"  method="get">
            <table>
                <tr>
                    <td>
                        <p>Enter a type of animal</p>
                    </td>
                    <td>
                        <input type="text" placeholder="Type of animal" name="type" id="type">
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>Enter a name</p>
                    </td>
                    <td>
                        <input type="text" placeholder="Name the animal" name="name" id="name">
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>What month were you born</p>
                    </td>
                    <td>
                        <select name="month" id="month">
                            <option>January</option>
                            <option>February</option>
                            <option>March</option>
                            <option>April</option>
                            <option>May</option>
                            <option>June</option>
                            <option>July</option>
                            <option>August</option>
                            <option>September</option>
                            <option>October</option>
                            <option>November</option>
                            <option>December</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>What is your favourite color</p>
                    </td>
                    <td>
                        <input type="color" name="color" checked id="color">
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <input type="submit" value="Generate"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        <p>Enter a material</p>
                    </td>
                    <td>
                        <input type="text" placeholder="material" name="material" id="material">
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <input type="submit" value="Generate"/>
                    </td>
                </tr>
            </table>
        </form>
    </div>
    
</body>
</html>